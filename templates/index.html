{% extends "base.html" %}
{% block title %}Restaurant List{% endblock %}
{% block head %}
    {{ super() }}
    <style>
      body {
          min-height: 75rem;
          padding-top: 4.5rem;
      }
    </style>
{% endblock %}
{% block content %}
    <h1>Images</h1>
    <div class="d-flex justify-content-end align-items-center mb-3">
        <form method="get" class="row g-2 align-items-end w-100">
            <div class="col-auto">
              <label for="sort" class="form-label">Ordenar por:</label>
              <select name="sort" id="sort" class="form-select form-select-sm" onchange="this.form.submit()">
                <optgroup label="Fecha de subida">
                  <option value="time_desc" {% if current_sort=='time_desc' %}selected{% endif %}>Más reciente primero</option>
                  <option value="time_asc" {% if current_sort=='time_asc' %}selected{% endif %}>Más antiguo primero</option>
                </optgroup>
                <optgroup label="Píxeles rojos">
                  <option value="red_desc" {% if current_sort=='red_desc' %}selected{% endif %}>Más rojos primero</option>
                  <option value="red_asc" {% if current_sort=='red_asc' %}selected{% endif %}>Menos rojos primero</option>
                </optgroup>
                <optgroup label="Píxeles verdes">
                  <option value="green_desc" {% if current_sort=='green_desc' %}selected{% endif %}>Más verdes primero</option>
                  <option value="green_asc" {% if current_sort=='green_asc' %}selected{% endif %}>Menos verdes primero</option>
                </optgroup>
                <optgroup label="Píxeles azules">
                  <option value="blue_desc" {% if current_sort=='blue_desc' %}selected{% endif %}>Más azules primero</option>
                  <option value="blue_asc" {% if current_sort=='blue_asc' %}selected{% endif %}>Menos azules primero</option>
                </optgroup>
              </select>
            </div>
          
            <div class="col-auto">
              <label for="user_name" class="form-label">Usuario:</label>
              <input type="text" name="user_name" id="user_name" class="form-control form-control-sm"
                     value="{{ current_user_filter }}">
            </div>
          
            <div class="col-auto">
              <label for="from_date" class="form-label">Desde (fecha y hora):</label>
              <input type="datetime-local" name="from_date" id="from_date" class="form-control form-control-sm"
                     value="{{ current_from_date }}">
            </div>
          
            <div class="col-auto">
              <label for="to_date" class="form-label">Hasta (fecha y hora):</label>
              <input type="datetime-local" name="to_date" id="to_date" class="form-control form-control-sm"
                     value="{{ current_to_date }}">
            </div>
          
            <div class="col-auto">
              <button type="submit" class="btn btn-primary btn-sm">Filtrar</button>
            </div>
          
            <div class="col-auto">
              <a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm">Reset</a>
            </div>
          </form>          
      </div>      
      
    {% if images %}
        <table class="table">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Red Pixels</th>
                    <th>Green Pixels</th>
                    <th>Blue Pixels</th>
                    <th>Image Name</th>
                    <th>Uploaded At</th>
                    <th>Image</th>
                </tr>
            </thead>
            <tbody>
                {% for image in images %}
                    <tr>
                        <td>{{ image.user_name }}</td>
                        <td>{{ image.red_pixels }}</td>
                        <td>{{ image.green_pixels }}</td>
                        <td>{{ image.blue_pixels }}</td>
                        <td>{{ image.name }}</td>
                        <td>{{ image.upload_time }}</td>
                        <td><img src="{{ url_for('uploaded_file', filename=image.image_path) }}" alt="Uploaded Image" style="width: 100px; height: 100px;"></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No images exist. Select Add new image to add one.</p>
    {% endif %}
        

      <div class="d-flex justify-content-end">
              <a href="{{ url_for('create_image') }}" class="btn btn-success px-4 gap-3">Add new image</a>
      </div>

      <!-- GALERÍA DE IMÁGENES SUBIDAS -->
      <hr>
      <h2 class="mt-5">Image Gallery</h2>
      <div class="row">
          {% for image in images %}
              <div class="col-md-4 mb-4">
                  <div class="card">
                      <img src="{{ url_for('uploaded_file', filename=image.image_path) }}" class="card-img-top" alt="Uploaded Image">
                      <div class="card-body">
                          <p class="card-text">Uploaded at: {{ image.upload_time }}</p>
                      </div>
                  </div>
              </div>
          {% endfor %}
      </div>
{% endblock %}
